# idobata-analyst システム解説（改訂版）

## 概要
idobata-analystは、多様なソース（YouTube、X/Twitter、フォームなど）から収集したコメントデータを分析し、論点ごとの立場を特定・集計するシステムです。AIを活用して、生のコメントから意味のある洞察を抽出し、論点と立場のマトリックス構造として整理します。

## 分析パイプラインの抽象的理解

idobata-analystの分析パイプラインは、生のコメントデータから構造化された洞察を抽出する一連の変換プロセスとして理解できます：

### 1. コンテンツの関連性フィルタリング

システムは最初に、各コメントがプロジェクトのトピックに関連しているかどうかを判断します。これは単なるメソッド呼び出しではなく、**意味的フィルタリング**のプロセスです：

- AIモデルは、コメントの内容とプロジェクトのトピックを比較し、意味的な関連性を評価
- 関連性の低いコメントは早期に除外され、後続の分析リソースを節約
- このプロセスは二値的判断（関連あり/なし）を生成し、分析の焦点を絞る

### 2. コンテンツの抽象化と正規化

関連性のあるコメントは、次に**抽象化と正規化**のプロセスを経ます：

- 生のコメントから主要な主張や意見を抽出
- 冗長な表現や余分な情報を削除し、本質的な内容に集中
- 様々な表現形式を統一された形式に変換（正規化）
- 結果として、元のコメントの本質を保持しつつ、分析しやすい形式に変換

### 3. 論点の自動生成と抽出

システムの重要な機能の一つは、コメントの集合から**論点を自動的に抽出**する能力です：

- コメント群から頻出するトピックやテーマを特定
- 論点を質問形式で構造化（例：「〇〇すべきか？」）
- 論点の多様性を確保（意見が一致する論点と分かれる論点のバランス）
- 各論点に対して想定される立場（視点）を自動生成

このプロセスは、`question-generation.txt`プロンプトを使用して実行され、コメントの集合から意味のある論点構造を創出します。

### 4. 立場分析と信頼度評価

各コメントに対して、システムは**立場分析**を行います：

- 各コメントを各論点に対して評価
- コメントが表明している立場（視点）を特定
- 立場の判断に対する信頼度を数値化（0〜1）
- 信頼度が閾値（0.8）未満の場合、立場判断を保留

このプロセスは単なる分類ではなく、コメントの内容と論点・立場の関係性を理解する深い意味解析です。

## データ構造の抽象的理解

idobata-analystのデータ構造は、単なる型定義ではなく、**論点と立場のマトリックス**として理解できます：

### 論点-立場マトリックス

システムの中核となるデータ構造は、論点と立場のマトリックスです：

```
                立場A    立場B    立場C    ...
論点1           ■■■     ■        ■■      
論点2           ■        ■■■■    ■       
論点3           ■■      ■■       ■■■     
...
```

- 各セルの大きさは、その論点におけるその立場のコメント数を表す
- マトリックス全体で、コメント群の意見分布を視覚化
- 特定の論点や立場に集中したり、均等に分散したりするパターンを把握可能

### データの階層構造

実際のデータは階層的に構造化されています：

1. **プロジェクト層**：分析の最上位単位
   - 名前、説明、複数の論点を含む

2. **論点層**：プロジェクト内の個別の質問や議題
   - テキスト形式の質問
   - 関連する複数の立場（視点）

3. **立場層**：論点に対する異なる視点や意見
   - 名前（例：「規制強化派」「自由市場派」）
   - 特殊な立場（「立場なし」「その他の立場」）も含む

4. **コメント層**：実際のユーザー発言
   - 元のコメント内容
   - 抽出された主張
   - 関連性フラグ
   - ソース情報（YouTube、X、フォームなど）

5. **コメント-立場関連**：コメントと立場の関係性
   - どの論点のどの立場に属するか
   - 判断の信頼度

### 分析結果の集約構造

最終的な分析結果は、論点ごとに集約されます：

- 各立場のコメント数
- 各立場の代表的なコメント例
- 立場間の関係性や対立点の分析
- 全体的な意見分布の傾向

この集約構造により、大量のコメントから意味のある洞察を抽出し、理解しやすい形で提示することが可能になります。

## AIプロンプトの役割

システムの各処理段階では、専用のプロンプトテンプレートがAIモデルに指示を与えます：

1. **relevance-check.txt**：関連性判断の基準を定義
2. **content-extraction.txt**：主張抽出の方法を指定
3. **question-generation.txt**：論点と立場の自動生成方法を定義
4. **stance-analysis.txt**：立場判断の基準と方法を指定

これらのプロンプトは単なる指示文ではなく、システムの「思考プロセス」を定義する重要な要素です。各プロンプトは、特定の分析タスクに対するAIの思考フレームワークを構築します。

## まとめ

idobata-analystは、生のコメントデータから意味のある構造を抽出し、論点と立場のマトリックスとして整理するシステムです。その処理は単なるメソッド呼び出しの連鎖ではなく、意味的フィルタリング、抽象化と正規化、論点抽出、立場分析という一連の意味変換プロセスとして理解できます。

このシステムの真の価値は、大量の非構造化テキストから意味のある洞察を抽出し、人間が理解しやすい形で提示する能力にあります。AIを活用した意味解析により、多様な意見の分布を可視化し、議論の全体像を把握することを可能にします。
